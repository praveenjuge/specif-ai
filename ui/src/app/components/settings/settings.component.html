<div class="divide-y overflow-hidden rounded-lg bg-card border w-full">
  <div class="px-4 py-4">
    <h1 class="text-xl font-medium leading-tight tracking-tight">Settings</h1>
  </div>
  <div class="doc-section-height grid grid-cols-[minmax(0,1fr)_minmax(0,3fr)]">
    <!-- Left-side tabs navigation -->
    <div class="border-r overflow-auto h-full">
      <h2 id="settings-tabs" class="sr-only">Settings sections</h2>
      <div role="tablist" aria-labelledby="settings-tabs">
        <button
          id="tab-general"
          role="tab"
          (click)="onTabChange('general')"
          [attr.aria-selected]="activeTab === 'general'"
          [attr.tabindex]="activeTab === 'general' ? null : -1"
          aria-controls="panel-general"
          [class]="
            activeTab === 'general'
              ? 'bg-accent text-primary border-primary'
              : 'border-transparent text-muted-foreground hover:bg-accent'
          "
          class="w-full px-3 py-3 text-sm font-medium text-left focus:outline-none border-l-2"
        >
          General
        </button>
        <button
          id="tab-about"
          role="tab"
          (click)="onTabChange('about')"
          [attr.aria-selected]="activeTab === 'about'"
          [attr.tabindex]="activeTab === 'about' ? null : -1"
          aria-controls="panel-about"
          [class]="
            activeTab === 'about'
              ? 'bg-accent text-primary border-primary'
              : 'border-transparent text-muted-foreground hover:bg-accent'
          "
          class="w-full px-3 py-3 text-sm font-medium text-left focus:outline-none border-l-2"
        >
          About
        </button>
      </div>
    </div>

    <!-- Right-side content area -->
    <div class="px-6 py-5 h-full overflow-auto">
      <!-- Error Message -->
      <div
        *ngIf="errorMessage && hasChanges"
        class="mb-6 p-2 text-destructive font-medium bg-red-50 rounded"
      >
        {{ errorMessage }}
      </div>

      <!-- General Tab Content -->
      <div
        id="panel-general"
        role="tabpanel"
        [attr.aria-labelledby]="'tab-general'"
        *ngIf="activeTab == 'general'"
      >
        <form [formGroup]="configForm" class="space-y-8 divide-y">
          <!-- LLM Configuration -->
          <div class="space-y-4">
            <div>
              <h2 class="text-base font-medium leading-7">LLM Configuration</h2>
              <p class="text-sm leading-6 text-muted-foreground">
                Configure your Language Model provider settings
              </p>
            </div>

            <!-- Providers Dropdown -->
            <div class="space-y-2">
              <label for="providerSelect" class="block text-sm font-medium">
                LLM Provider
              </label>
              <div class="relative">
                <app-select
                  id="providerSelect"
                  formControlName="provider"
                  [options]="providerOptions"
                  [searchable]="false"
                  [required]="true"
                  [clearable]="true"
                  placeholder="Select LLM Provider"
                ></app-select>
              </div>
            </div>

            <!-- Provider-specific Configuration -->
            <div formGroupName="config" class="mt-4">
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <ng-container *ngFor="let field of currentProviderFields">
                  <div
                    *ngIf="field.type !== 'checkbox' && field.type !== 'select'"
                    class="space-y-2"
                  >
                    <label [for]="field.name" class="block text-sm font-medium">
                      {{ field.label }}
                      <span *ngIf="field.required" class="text-destructive"
                        >*</span
                      >
                    </label>
                    <input
                      [type]="field.type"
                      [id]="field.name"
                      [formControlName]="field.name"
                      [placeholder]="field.placeholder || ''"
                      class="flex items-center h-10 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
                      [required]="field.required || false"
                    />
                  </div>

                  <!-- Select Input -->
                  <div *ngIf="field.type === 'select'" class="space-y-2">
                    <label [for]="field.name" class="block text-sm font-medium">
                      {{ field.label }}
                      <span *ngIf="field.required" class="text-destructive"
                        >*</span
                      >
                    </label>
                    <div class="relative">
                      <app-select
                        [id]="field.name"
                        [formControlName]="field.name"
                        [options]="field.options || []"
                        [searchable]="field.useAutocomplete || false"
                        [required]="field.required || false"
                        [placeholder]="'Select ' + field.label"
                      ></app-select>
                    </div>
                  </div>

                  <!-- Checkbox Input -->
                  <div
                    *ngIf="field.type === 'checkbox'"
                    class="col-span-1 sm:col-span-2 gap-3 flex items-center"
                  >
                    <input
                      type="checkbox"
                      [id]="field.name"
                      [formControlName]="field.name"
                      class="h-4 w-4 text-primary focus:ring-primaryold-500 border-slate-300 rounded"
                    />
                    <label [for]="field.name" class="block text-sm font-medium">
                      {{ field.label }}
                    </label>
                  </div>
                </ng-container>
              </div>
            </div>
          </div>

          <!-- Analytics Settings -->
          <div class="space-y-4 pt-6">
            <div>
              <h2 class="text-base font-medium leading-7">Analytics</h2>
              <p class="text-sm leading-6 text-muted-foreground">
                Configure analytics and data collection preferences
              </p>
            </div>

            <div class="rounded-lg border divide-y">
              <div class="px-4 py-3 flex items-center justify-between">
                <span class="text-sm">Enable Analytics Tracking</span>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    id="analyticsToggle"
                    [formControl]="analyticsEnabled"
                    class="sr-only peer"
                  />
                  <div
                    class="w-11 h-6 bg-slate-200 dark:bg-slate-800 peer-focus:outline-none peer-focus:ring-1 peer-focus:ring-primaryold-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primaryold-500"
                  ></div>
                </label>
              </div>
            </div>
            <div *ngIf="analyticsWarning">
              <p class="text-amber-600 text-xs flex items-center gap-1">
                <ng-icon
                  name="heroExclamationTriangle"
                  class="text-md"
                ></ng-icon>
                {{ analyticsWarning }}
              </p>
            </div>
          </div>

          <!-- Destination Settings -->
          <div class="space-y-4 pt-6">
            <div>
              <h2 class="text-base font-medium leading-7">Destination</h2>
              <p class="text-sm leading-6 text-muted-foreground">
                Configure where your generated requirements will be stored
              </p>
            </div>

            <div class="space-y-2">
              <label for="workingDir" class="block text-sm font-medium">
                Storage Location
              </label>
              <div class="flex w-full">
                <input
                  type="text"
                  [value]="workingDir"
                  placeholder="Choose Destination Folder"
                  disabled
                  id="workingDir"
                  class="flex items-center h-10 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm"
                />
                <app-button
                  [buttonContent]="'Browse'"
                  [theme]="'primary'"
                  [rounded]="'none'"
                  [roundedRight]="'lg'"
                  (click)="openFolderSelector()"
                ></app-button>
              </div>
            </div>
          </div>

          <!-- Update Settings -->
          <div class="space-y-4 pt-6">
            <div>
              <h2 class="text-base font-medium leading-7">Update</h2>
              <p class="text-sm leading-6 text-muted-foreground">
                Configure automatic updates and version management
              </p>
            </div>

            <div class="rounded-lg border divide-y">
              <div class="px-4 py-3 flex items-center justify-between">
                <span class="text-sm">Automatic Updates</span>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    id="autoUpdatesToggle"
                    [formControl]="autoUpdateEnabled"
                    class="sr-only peer"
                  />
                  <div
                    class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-1 peer-focus:ring-primaryold-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primaryold-500"
                  ></div>
                </label>
              </div>
              <button
                class="w-full px-4 py-3 text-sm flex items-center justify-between"
                role="button"
                tabindex="0"
                (click)="checkForUpdates()"
                (keydown.enter)="checkForUpdates()"
                (keydown.space)="checkForUpdates(); $event.preventDefault()"
              >
                <span>Check for Updates</span>
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  class="text-slate-400"
                >
                  <path
                    d="M7.5 15L12.5 10L7.5 5"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
            </div>
          </div>
        </form>

        <!-- Action Buttons -->
        <div class="mt-8 flex items-center justify-end gap-x-2">
          <app-button
            *ngIf="hasChanges"
            buttonContent="Discard"
            theme="secondary_outline"
            size="sm"
            (click)="navigateToHome()"
          />
          <app-button
            *ngIf="hasChanges"
            buttonContent="Save"
            theme="primary"
            size="sm"
            (click)="onSave()"
            [disabled]="!configForm.valid"
          />
        </div>
      </div>

      <!-- About Tab Content -->
      <div
        id="panel-about"
        role="tabpanel"
        [attr.aria-labelledby]="'tab-about'"
        *ngIf="activeTab === 'about'"
        class="space-y-4 overflow-hidden"
      >
        <div class="rounded-lg border divide-y overflow-hidden">
          <div class="px-4 py-3 flex items-center justify-between">
            <span class="text-sm">Accelerate SDLC process with</span>
            <img
              *ngIf="themeConfiguration.companyLogoColor.length > 0"
              class="h-3 w-auto"
              [src]="themeConfiguration.companyLogoColor"
              [alt]="themeConfiguration.companyName"
            />
          </div>
          <div class="px-4 py-3 flex items-center justify-between">
            <span class="text-sm">Version</span>
            <span class="text-sm text-slate-600">{{
              getAboutContent().version
            }}</span>
          </div>
          <button
            class="w-full px-4 py-3 text-sm text-destructive flex items-center justify-between"
            role="button"
            tabindex="0"
            (click)="logout()"
            (keydown.enter)="logout()"
            (keydown.space)="logout(); $event.preventDefault()"
          >
            <span>Log Out</span>
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              class="text-destructive"
            >
              <path
                d="M7.5 15L12.5 10L7.5 5"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
